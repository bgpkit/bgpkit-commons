# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

### Building
- `cargo build` - Build the library with default features
- `cargo build --features native-tls` - Build with native-tls backend
- `cargo build --features rustls` - Build with rustls backend (default)
- `cargo build --all-features` - Build with all features enabled

### Testing  
- `cargo test` - Run all tests
- `cargo test <test_name>` - Run specific test
- `cargo test --features asinfo` - Run tests with asinfo feature enabled

### Code Quality
- `cargo fmt --check` - Check code formatting (required for CI)
- `cargo fmt` - Format code
- `cargo clippy --all-features -- -D warnings` - Run clippy lints (CI fails on warnings)

### Documentation
- `cargo readme` - Generate README.md from lib.rs doc comments (requires cargo-readme)
- `cargo doc --open` - Generate and open documentation

## Architecture Overview

This is a Rust library providing BGP-related data and utilities through a single `BgpkitCommons` struct that lazily loads different data modules as needed.

### Core Design Pattern
The library follows a lazy-loading pattern:
1. Create a `BgpkitCommons` instance with `BgpkitCommons::new()`
2. Load only the data modules you need with `load_xxx()` methods
3. Use the data through corresponding `xxx_yyy()` methods

### Module Structure
- **mrt_collectors/**: RouteViews and RIPE RIS collector information
- **asinfo/** (feature-gated): AS information, country lookup, population data, hegemony scores
- **countries/**: Country code to name mappings
- **rpki/**: RPKI validation data (historical from RIPE, real-time from Cloudflare)  
- **bogons/**: Bogon ASN and prefix detection
- **as2rel/**: AS-level relationship data

### Feature Flags

#### Module Features
- `asinfo`: AS information, country lookup, population data, hegemony scores (requires as2org-rs and peeringdb-rs)
- `as2rel`: AS-level relationship data generated by BGPKIT
- `bogons`: Bogon ASN and prefix detection from IANA registries
- `countries`: Country code to name mappings from GeoNames
- `mrt_collectors`: RouteViews and RIPE RIS collector information
- `rpki`: RPKI validation data (historical from RIPE, real-time from Cloudflare)

#### Dependency Management
- All dependencies except `anyhow` are optional and only included when their respective features are enabled
- This allows for minimal builds with only the required functionality

#### Convenience Features
- `all`: Enables all module features (this is the default for backwards compatibility)
- `default = ["all"]`: All modules enabled by default

#### Building with Specific Features
```bash
# Build with only bogons support
cargo build --no-default-features --features bogons

# Build with asinfo and countries only  
cargo build --no-default-features --features "asinfo,countries"

# Build with all features (same as default)
cargo build --features all
```

#### Examples
Each example has required features specified:
- `as2org`: requires `asinfo` and `countries` features
- `collectors`: requires `mrt_collectors` feature  
- `list_aspas`: requires `rpki` feature

Examples will automatically use the correct features when built with default settings, or you can build them with minimal features:
```bash
cargo run --no-default-features --features "rpki" --example list_aspas
```

### Key Implementation Details
- All data loading methods return `Result<()>` and can fail if external APIs are unavailable
- The `reload()` method refreshes all currently loaded data sources
- RPKI data can be loaded for specific dates (historical) or current (Cloudflare API)
- AsInfo supports both fresh loading and cached data loading with `load_asinfo_cached()`

### Testing Structure
- Unit tests are embedded in module files
- Integration tests in `tests/` directory test full workflows
- Examples in `examples/` directory demonstrate usage patterns